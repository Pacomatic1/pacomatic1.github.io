<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Now you're playing with super power!</title>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:600">
        <style>
            body {
                margin: 0;
                padding: 0;
                /* background-color: black; */
            }
            .credits {
                    /* height: 100vh;
                    width: 100vw; */
                    text-align: right;
                    color: white;
                    font-size: 0.8em;
                    font-family: 'Source Sans Pro';
                    font-weight:600;
                    position: fixed;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    margin-left:0px;
                    margin-right:2em;
                }
        </style>
            <!-- // This is for three.js. I wanted to use Cubified's Mode 7 code but their fake 3D is comically slow compared to actual 3D. Then again, three.js uses WebGL and Cubified doesn't; I can't blame the latter *too* much. -->
    
        <script type="importmap">
            { 
              "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.176.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.176.0/examples/jsm/"
              }
            }
        </script>
        
    </head>
    <body>
        <div class="credits">
            <p>
                Made with <a href="https://github.com/mrdoob/three.js">three.js.</a>
            </p>
        </div>
        

        <script type="module">
            /*  REMEMBER: This is a module script, so you cannot run it using an external .js file when running locally. You also cannot use any textures when running this locally.
            In order to do that, you need to run a local server, most easily done using Node.js + npm + the serve extension:
            -----
            npx serve <path to background folder>
            -----
            Sadly, npx is stupid and it makes iframes reference image paths relative to the root and not the iframe's location. This breaks the entire site. 
            Don't worry though, none of will cause issues once pushed to any web host; Neocities, GitHub, or Nekoweb.
            All this to say: Set up the Node.js server, and remember to stay pissed! */
        

            import * as THREE from 'three';

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera( 40, window.innerWidth / window.innerHeight, 0.1, 1000 );
            
            const renderer = new THREE.WebGLRenderer({ alpha: true } );
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.setAnimationLoop( animate );
            document.body.appendChild( renderer.domElement );
            
            // Pick the texture to use
            
            var textureToLoad = '../assets/threejswall.webp';
            
            // Create the flat plane (MODE 7!!!!!) 
            const geometry = new THREE.PlaneGeometry( 4, 4, 4 );

            // If we're running on file://, disable the texture to avoid a bunch of issues.
            var material;
            if (willThereBeCorsIssues()) {
                material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
                console.log("From the background: The way three.js loads textures means that running on file:// causes CORS issues. As such, the textures are disabled. if you'd like to see hit this looks without this issue, please run a local server and view the background on there. An easy way is to get Node.js, npm, and the serve extension, then use 'npx serve <project directory here>'.");
            } else {
                const loader = new THREE.TextureLoader();
                const texture = loader.load(textureToLoad);
                texture.colorSpace = THREE.SRGBColorSpace;
                texture.minFilter = THREE.NearestFilter;
                texture.magFilter = THREE.NearestFilter;    
                material = new THREE.MeshBasicMaterial( { map: texture } );
            }
            
            material.transparent = true;
            material.side = THREE.DoubleSide
            const plane = new THREE.Mesh( geometry, material );
            plane.rotation.x = 1.5708; // three.js uses radians. This is 90 in degrees.
            scene.add( plane );

            camera.position.y = 2.1;
            camera.position.z = 5;
            camera.lookAt(0,.2,0);

            function animate() {
                plane.rotation.z += 0.01;
                renderer.render( scene, camera );
            }

            addEventListener("resize", (event) => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            function willThereBeCorsIssues() {
                return window.location.href.includes("file:");
                // three.js does NOT like local files. C'est la vie.
            }
        </script>
    </body>
</html>